<!doctype html>
<html>
  <head>
  	<link rel="icon" href="data:image/x-icon;base64,Qk02CAAAAAAAADYEAAAoAAAAIAAAACAAAAABAAgAAAAAAAAEAADEDgAAxA4AAAAAAAAAAAAAAAAAAAAAgAAAgAAAAICAAIAAAACAAIAAgIAAAMDAwADA3MAA8MqmAAAgQAAAIGAAACCAAAAgoAAAIMAAACDgAABAAAAAQCAAAEBAAABAYAAAQIAAAECgAABAwAAAQOAAAGAAAABgIAAAYEAAAGBgAABggAAAYKAAAGDAAABg4AAAgAAAAIAgAACAQAAAgGAAAICAAACAoAAAgMAAAIDgAACgAAAAoCAAAKBAAACgYAAAoIAAAKCgAACgwAAAoOAAAMAAAADAIAAAwEAAAMBgAADAgAAAwKAAAMDAAADA4AAA4AAAAOAgAADgQAAA4GAAAOCAAADgoAAA4MAAAODgAEAAAABAACAAQABAAEAAYABAAIAAQACgAEAAwABAAOAAQCAAAEAgIABAIEAAQCBgAEAggABAIKAAQCDAAEAg4ABAQAAAQEAgAEBAQABAQGAAQECAAEBAoABAQMAAQEDgAEBgAABAYCAAQGBAAEBgYABAYIAAQGCgAEBgwABAYOAAQIAAAECAIABAgEAAQIBgAECAgABAgKAAQIDAAECA4ABAoAAAQKAgAECgQABAoGAAQKCAAECgoABAoMAAQKDgAEDAAABAwCAAQMBAAEDAYABAwIAAQMCgAEDAwABAwOAAQOAAAEDgIABA4EAAQOBgAEDggABA4KAAQODAAEDg4ACAAAAAgAAgAIAAQACAAGAAgACAAIAAoACAAMAAgADgAIAgAACAICAAgCBAAIAgYACAIIAAgCCgAIAgwACAIOAAgEAAAIBAIACAQEAAgEBgAIBAgACAQKAAgEDAAIBA4ACAYAAAgGAgAIBgQACAYGAAgGCAAIBgoACAYMAAgGDgAICAAACAgCAAgIBAAICAYACAgIAAgICgAICAwACAgOAAgKAAAICgIACAoEAAgKBgAICggACAoKAAgKDAAICg4ACAwAAAgMAgAIDAQACAwGAAgMCAAIDAoACAwMAAgMDgAIDgAACA4CAAgOBAAIDgYACA4IAAgOCgAIDgwACA4OAAwAAAAMAAIADAAEAAwABgAMAAgADAAKAAwADAAMAA4ADAIAAAwCAgAMAgQADAIGAAwCCAAMAgoADAIMAAwCDgAMBAAADAQCAAwEBAAMBAYADAQIAAwECgAMBAwADAQOAAwGAAAMBgIADAYEAAwGBgAMBggADAYKAAwGDAAMBg4ADAgAAAwIAgAMCAQADAgGAAwICAAMCAoADAgMAAwIDgAMCgAADAoCAAwKBAAMCgYADAoIAAwKCgAMCgwADAoOAAwMAAAMDAIADAwEAAwMBgAMDAgADAwKAA8Pv/AKSgoACAgIAAAAD/AAD/AAAA//8A/wAAAP8A/wD//wAA////AODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4OCQAAAAAABISNjg4ODg4NgA2ODg4ODg4ODg4ODg4ODg4EgAAAAAAAAAAACQ4ODgkABI4ODg4ODg4ODg4ODg4ODg4ABI2JCQSEgAAABI4ODgAEjg4ODg4ODg4ODg4ODg4ODg4Njg4ODg4OCQAADg4ODgkODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4OiQANjg4NgA2ODg4ODg4ODg4ODg4ODg4ODg4ODg4NiQAABI4ODg4ABI4ODg4ODg4ODg4ODg4ODg4OCQAAAAAACQ2ODg4ODgSADY4ODg4ODg4ODg4ODg4ODg2AAAkNjg4ODg4ODg4ODgAEjg4ODg4ODg4ODg4ODg4ODgAADg4ODg4ODg4ODg4OBIANjg4ODg4ODg4ODg4ODg4OAAAACQ4OjoSEjg4ODg4NgAAODg4ODg4ODg4ODg4ODg4NgAAAAAAEiQAACQ4ODg4AAA2ODg4ODg4ODg4ODg4ODg4OBIAAAAAAAAAADg4ODgkAAA4ODg4ODg4ODg4ODg4ODg4ODg2EhIAAAASODg4ODgAADg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4OA=">
    <title class="logo">Sprach!</title>
<style>
    /*Style settings*/
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font: 13px Helvetica, Arial; background: #cecece; }
    form { background: #949696; padding: 5.8px; position: fixed; bottom: 0; width: 90%; border-radius: 0px; }
    form input { border: 0; padding: 10px; width: 90%; margin-right: .7%; }
    #sidebar {background-color:#949696; height:90vh; width:10vw; float: left;}
    hr { color: #949696; height: 6px; border: none;}
</style>
  </head>
<body>
	<!--Refrenced Libraries-->
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<!--Website Layout-->
<div class="col-xs-12" style="overflow: scroll; height: 83vh;"> <!--Important hypertext website layout formater displing devise elements and integrated styles.-->
	<!--Adaptive server side Table-->
    <ul class="table table-striped" id="messages"></ul>
    <img id="image" src="">
        <form class="from-control">
        	<div class="form-group">
          <input class="form-control col-xs-8" col-xs-8" id="u" autocomplete="off" maxlength="100" placeholder="Username" required /><button class="btn btn-primary col-xs-2" id="btnSub">Send</button>
      </div>
      <div class="form-group">
          <input class="form-control col-xs-8" id="m" autocomplete="off" maxlength="100000" /><label class="btn btn-primary btn-file col-xs-2">Browse <input type="file" style="display: none;" onchange="fileAsURL(this)"></label>
      </div>
          <input id="i" /><input id="zyx" />
</form>
</div>
</body>
</html>
<script>
	//Variables
	var nameusers = [];
    var un = 0;
    var spiel = 0;
    //Hides Image URL and other storing features.
    $('#i').hide();
    $('#zyx').hide();
    $('#usernames').hide();
	//URL Converter
	function fileAsURL(element) {
  		var file = element.files[0];
  		var reader = new FileReader();
  		reader.onloadend = function() {
  			document.getElementById('i').value = reader.result;
  		}
  		reader.readAsDataURL(file);
	}

    $(function () {
    var socket = io();
    $('form').submit(function(){
    	        	console.log(spiel);
      setTimeout(function(){ 
        if (spiel > 0) {
        	spiel -= 1;
        } 
  	  }, 5000); 
      spiel += 1; 
      if (spiel > 5) {
      	$('#btnSub').prop('disabled', true);
      	setTimeout(function(){ 
    	$('#btnSub').prop('disabled', false); 
  	  }, 5000);
      };
              	console.log(spiel); 
      socket.emit('username', $('#u').val()); //Send username
    $('#u').prop('disabled', true); //Disables editing of username.
      socket.emit('chat message', $('#m').val());
	  socket.emit('picture', $('#i').val());
      $('#m').val('');
	  $('#p').val('');
      $('#i').val('');
      return false;
    });
    socket.on('chat message', function(msg){
      $('#messages').append($('<li>').text(msg)); //Displays message.
    });
	socket.on('picture', function(pic){
	  $('#messages').append($('<img>').attr("src", pic)); //Displays picture.
	  $('#messages').append($('<li>').text(""));
	});
  socket.on('username', function(use){
  	  var alternate = document.getElementById('zyx').value;
  	  var userna = document.getElementById('u').value;
  	  console.log(alternate);
  	  console.log(userna);
      var idon = nameusers.indexOf(use);
      if (idon == -1) {
      	$('#messages').append($('<li>').text(use)); //Displays username.
      	$('#usernames').append($('<li>').text(use));
      	un += 1;
      	$('#num').text(un);
      	var xyz = document.getElementById('u').value;
        document.getElementById('zyx').value = xyz;
      }else if (userna == alternate) {
        $('#messages').append($('<li>').text(use)); //Displays username.
      }else{
      	$('#messages').append($('<li>').text("Unknown")); //Displays username.
      	alert("Someone already has that username!");
      	$('#u').prop('disabled', false);
      }
      nameusers.push(use);
    });
  });
</script>